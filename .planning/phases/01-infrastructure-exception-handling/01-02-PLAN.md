---
phase: 01-infrastructure-exception-handling
plan: "02"
type: execute
wave: 2
depends_on:
  - "01-01"
files_modified:
  - aadap/orchestrator/graph.py
  - aadap/orchestrator/graph_executor.py
autonomous: true
requirements:
  - EXCPT-01
  - EXCPT-02
must_haves:
  truths:
    - "graph.py catches specific exception types (OrchestratorError, AgentLifecycleError) instead of bare Exception"
    - "graph_executor.py catches specific exception types instead of bare Exception"
    - "Error logs include error_code and severity from exception context"
    - "Unexpected exceptions are logged with full traceback and re-raised"
  artifacts:
    - path: "aadap/orchestrator/graph.py"
      provides: "Orchestrator graph with proper exception handling"
      contains: "except (OrchestratorError"
    - path: "aadap/orchestrator/graph_executor.py"
      provides: "Graph executor with proper exception handling"
      not_contains: "except Exception as exc:"
  key_links:
    - from: "aadap/orchestrator/graph.py"
      to: "aadap/core/exceptions.py"
      via: "from aadap.core.exceptions import"
    - from: "graph.py run_task_graph"
      to: "exception handler"
      via: "try/except block"
---

<objective>
Replace bare `except Exception` handlers in orchestrator modules (graph.py, graph_executor.py) with specific exception types from the centralized taxonomy. Add proper logging with error context.

Purpose: Enable debugging with meaningful error messages instead of silent failures; preserve error context (task_id, error_code, severity) for traceability.
Output: Updated orchestrator files with specific exception handling.
</objective>

<execution_context>
@C:/Users/parth/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/parth/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/phases/01-infrastructure-exception-handling/01-CONTEXT.md
@.planning/phases/01-infrastructure-exception-handling/01-RESEARCH.md
@.planning/phases/01-infrastructure-exception-handling/01-01-SUMMARY.md

@aadap/orchestrator/graph.py
@aadap/orchestrator/graph_executor.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace bare except in graph.py (EXCPT-01)</name>
  <files>aadap/orchestrator/graph.py</files>
  <action>
Update `aadap/orchestrator/graph.py` to replace bare `except Exception` handlers with specific exception types.

1. Add import at top of file:
   ```python
   from aadap.core.exceptions import (
       AADAPError,
       OrchestratorError,
       AgentLifecycleError,
       IntegrationError,
   )
   ```

2. Fix exception handlers at these locations:
   - Lines 88-90 (dispatcher init): Change to `except (ConfigurationError, IntegrationError) as exc:`
   - Lines 97-100 (router init): Change to `except (ConfigurationError, IntegrationError) as exc:`
   - Lines 308-314 (_execute_routing): Change to `except OrchestratorError as exc:`, add error_code to log
   - Lines 345-351 (_execute_development): Change to `except (AgentLifecycleError, OrchestratorError) as exc:`, add error_code to log
   - Lines 385-391 (_execute_validation): Change to `except ExecutionError as exc:`, add error_code to log
   - Lines 419-425 (_execute_optimization): Change to `except ExecutionError as exc:`, add error_code to log
   - Lines 443-448 (_persist_transition): Change to `except AADAPError as exc:`, add error_code to log
   - Lines 571-582 (run_task_graph): This is the top-level handler - use specific types first, then catch-all with re-raise

3. For run_task_graph (lines 571-582), restructure as:
   ```python
   except (OrchestratorError, AgentLifecycleError) as exc:
       logger.error(
           "graph.run_failed",
           task_id=str(task_id),
           error_code=exc.error_code,
           severity=exc.severity.value,
           error=str(exc),
       )
       return {
           "task_id": str(task_id),
           "final_state": "CANCELLED",
           "success": False,
           "error_code": exc.error_code,
           "error": str(exc),
       }
   except Exception as exc:
       logger.exception(
           "graph.run_unexpected_error",
           task_id=str(task_id),
           error=str(exc),
       )
       raise
   ```

4. Add error_code to all error logs where AADAPError is caught.

Do NOT change the return structure of functions - preserve existing API contracts.
  </action>
  <verify>
cd D:/bionics && grep -n "except Exception" aadap/orchestrator/graph.py | wc -l
  </verify>
  <done>
graph.py has no bare `except Exception` handlers (except final catch-all with re-raise). All error logs include error_code when available. Imports from exceptions module work.
</done>
</task>

<task type="auto">
  <name>Task 2: Replace bare except in graph_executor.py (EXCPT-02)</name>
  <files>aadap/orchestrator/graph_executor.py</files>
  <action>
Update `aadap/orchestrator/graph_executor.py` to replace bare `except Exception` handlers with specific exception types.

1. Add import at top of file:
   ```python
   from aadap.core.exceptions import (
       AADAPError,
       OrchestratorError,
       ExecutionError,
       IntegrationError,
   )
   ```

2. Fix exception handlers at these locations:
   - Lines 87-98 (execute_routing): Change to `except OrchestratorError as exc:`, add error_code to log, preserve fallback behavior
   - Lines 195-204 (execute_direct_operation): Change to `except (IntegrationError, ExecutionError) as exc:`, add error_code to log
   - Lines 235-241 (execute_development): Change to `except (AgentLifecycleError, ExecutionError) as exc:`, add error_code to log
   - Lines 317-323 (execute_validation): Change to `except ExecutionError as exc:`, add error_code to log
   - Lines 359-365 (execute_optimization): Change to `except ExecutionError as exc:`, add error_code to log
   - Lines 424-431 (execute_on_platform): Change to `except IntegrationError as exc:`, add error_code to log

3. For each handler, update logger.error to include error_code:
   ```python
   logger.error(
       "executor.routing_failed",
       task_id=str(task_id),
       error_code=exc.error_code,
       severity=exc.severity.value,
       error=str(exc),
   )
   ```

4. Add AgentLifecycleError import since execute_development catches agent errors.

Preserve existing return values (AgentResult with success=False and error message).
  </action>
  <verify>
cd D:/bionics && grep -n "except Exception" aadap/orchestrator/graph_executor.py | wc -l
  </verify>
  <done>
graph_executor.py has no bare `except Exception` handlers. All error logs include error_code and severity when available. AgentResult returns preserved.
</done>
</task>

</tasks>

<verification>
1. `grep -c "except Exception" aadap/orchestrator/graph.py` returns 0 or 1 (only catch-all with re-raise)
2. `grep -c "except Exception" aadap/orchestrator/graph_executor.py` returns 0
3. Python imports succeed: `from aadap.orchestrator.graph import run_task_graph`
4. Python imports succeed: `from aadap.orchestrator.graph_executor import GraphExecutor`
</verification>

<success_criteria>
- No bare `except Exception:` blocks in graph.py (except top-level catch-all that re-raises)
- No bare `except Exception:` blocks in graph_executor.py
- Error logs include error_code and severity from exception context
- All modules import successfully
</success_criteria>

<output>
After completion, create `.planning/phases/01-infrastructure-exception-handling/01-02-SUMMARY.md`
</output>
