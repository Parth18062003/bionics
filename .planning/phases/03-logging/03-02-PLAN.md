---
phase: 03-logging
plan: 02
type: execute
wave: 2
depends_on: [03-01]
files_modified: []
autonomous: true
requirements: [LOGS-01, LOGS-02, LOGS-04, LOGS-05, LOGS-06, LOGS-08]

must_haves:
  truths:
    - "User sees logs embedded in task detail page"
    - "User can access dedicated /logs page with filters and search"
    - "User can filter by multiple levels and search by text"
    - "User can export logs as JSON or CSV"
  artifacts:
    - path: "frontend/src/app/logs/page.tsx"
      provides: "Dedicated log viewer page"
      contains: "LogsPage"
    - path: "frontend/src/components/logs/LogViewer.tsx"
      provides: "Reusable log viewer with filters"
      contains: "LogViewer"
    - path: "frontend/src/components/logs/LogEntry.tsx"
      provides: "Single log entry display"
      contains: "LogEntry"
    - path: "frontend/src/components/logs/LogFilters.tsx"
      provides: "Filter controls for levels and search"
      contains: "LogFilters"
  key_links:
    - from: "frontend/src/app/logs/page.tsx"
      to: "/api/logs"
      via: "fetch"
      pattern: "fetch.*api/logs"
    - from: "frontend/src/components/logs/LogViewer.tsx"
      to: "/api/tasks/{id}/logs"
      via: "fetch for embedded view"
      pattern: "fetch.*tasks.*logs"
---

<objective>
Create the log viewer frontend with embedded and dedicated views.

Purpose: Provide log visibility for debugging and monitoring tasks.
Output: Log viewer components, dedicated /logs page, embedded view in task detail.
</objective>

<execution_context>
@C:/Users/parth/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/parth/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-logging/03-CONTEXT.md
@.planning/REQUIREMENTS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create log types and hooks</name>
  <files>frontend/src/types/log.ts, frontend/src/hooks/useLogs.ts</files>
  <action>
    Create TypeScript types and React hooks for log functionality:
    
    1. **Types (frontend/src/types/log.ts)**:
       ```typescript
       type LogLevel = 'DEBUG' | 'INFO' | 'WARNING' | 'ERROR';
       
       interface TaskLog {
         id: string;
         task_id: string;
         timestamp: string;
         level: LogLevel;
         message: string;
         correlation_id: string | null;
         source: string | null;
       }
       
       interface LogQueryParams {
         task_id?: string;
         levels?: LogLevel[];
         search?: string;
         limit?: number;
         offset?: number;
         start_time?: string;
         end_time?: string;
       }
       
       interface LogsResponse {
         logs: TaskLog[];
         total: number;
         limit: number;
         offset: number;
       }
       ```
    
    2. **useLogs hook (frontend/src/hooks/useLogs.ts)**:
       - `logs: TaskLog[]` — Current logs
       - `total: number` — Total matching logs
       - `isLoading: boolean` — Loading state
       - `error: string | null` — Error message
       - `params: LogQueryParams` — Current filter params
       - `setParams(params)` — Update filters
       - `fetchLogs()` — Fetch logs with current params
       - `exportLogs(format: 'json' | 'csv')` — Download logs
       
       Fetch from API_BASE/api/logs with query params.
  </action>
  <verify>
    `cd frontend && npx tsc --noEmit src/types/log.ts src/hooks/useLogs.ts 2>&1 | head -20`
  </verify>
  <done>
    Log types and useLogs hook exist. Hook handles fetching, filtering, and export.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create log entry and filter components</name>
  <files>frontend/src/components/logs/LogEntry.tsx, frontend/src/components/logs/LogFilters.tsx</files>
  <action>
    Create reusable log UI components:
    
    1. **LogEntry.tsx** — Single log entry display:
       - Props: `log: TaskLog`, `onCorrelationClick?: (id: string) => void`
       - **Layout per CONTEXT.md**:
         - Left: Icon + color for level (ERROR=red, WARN=amber, INFO=blue, DEBUG=gray)
         - Timestamp (relative or absolute format)
         - Source/agent name (if present)
         - Message (truncated ~100 chars, click to expand)
         - Correlation ID chip (clickable to filter)
       - **Level icons**:
         - ERROR: Alert circle (red)
         - WARNING: Alert triangle (amber)
         - INFO: Info circle (blue)
         - DEBUG: Bug (gray)
       - **Expand/collapse** for long messages with animation
       - Use Tailwind for styling
    
    2. **LogFilters.tsx** — Filter controls:
       - Props: `params: LogQueryParams`, `onChange: (params) => void`
       - **Multi-select dropdown for levels** (per CONTEXT.md)
         - Checkboxes for each level
         - "Select all" / "Clear all" options
       - **Search input** with debounce (300ms)
       - **Optional**: Date range picker for start/end time
       - **Reset button** to clear all filters
  </action>
  <verify>
    `cd frontend && npx tsc --noEmit src/components/logs/LogEntry.tsx src/components/logs/LogFilters.tsx 2>&1 | head -20`
  </verify>
  <done>
    LogEntry and LogFilters components exist. LogEntry shows level icons, truncated message with expand, correlation chip. LogFilters has multi-select level dropdown and search.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create reusable LogViewer component</name>
  <files>frontend/src/components/logs/LogViewer.tsx, frontend/src/components/logs/index.ts</files>
  <action>
    Create LogViewer component for both embedded and dedicated views:
    
    1. **LogViewer.tsx**:
       - Props: 
         - `taskId?: string` — Optional task filter (for embedded view)
         - `limit?: number` — Max logs to show (default 50)
         - `showFilters?: boolean` — Show filter controls (default true)
         - `showExport?: boolean` — Show export button (default true)
         - `autoRefresh?: boolean` — Auto-refresh for real-time (default false)
       
       - **Auto-scroll + pause behavior** (per CONTEXT.md):
         - `isAtBottom` state tracked via scroll event
         - Auto-scrolls to bottom when new logs arrive AND user is at bottom
         - Pauses auto-scroll when user scrolls up
         - "Jump to latest" button appears when paused
       
       - **Features**:
         - Uses LogFilters for filtering (if showFilters)
         - Renders LogEntry for each log
         - Pagination or infinite scroll for large datasets
         - Export dropdown (JSON/CSV) if showExport
         - Empty state: "No logs found" with filter reset suggestion
       
       - **Auto-expand search** (per CONTEXT.md):
         - When no results, show suggestions: "Try removing level filter" or "Expand time range"
    
    2. **index.ts** — Export all log components
    
    3. **Auto-refresh for embedded view**:
       - If autoRefresh=true, poll /api/tasks/{id}/logs every 3 seconds
       - Use useEffect with interval, cleanup on unmount
  </action>
  <verify>
    `cd frontend && npx tsc --noEmit src/components/logs/LogViewer.tsx 2>&1 | head -20`
  </verify>
  <done>
    LogViewer component exists with auto-scroll/pause, filters, export, and auto-refresh options.
  </done>
</task>

<task type="auto">
  <name>Task 4: Create dedicated /logs page</name>
  <files>frontend/src/app/logs/page.tsx</files>
  <action>
    Create the dedicated log viewer page at /logs:
    
    1. **Page layout**:
       - Header: "Logs" title, task selector dropdown
       - LogFilters component
       - LogViewer component with full features
       - Export button (JSON/CSV)
    
    2. **Task selector** (per CONTEXT.md):
       - Dropdown to filter logs by task
       - Shows recent tasks (fetch from /api/v1/tasks?limit=20)
       - "All tasks" option to show logs across all tasks
    
    3. **URL state**:
       - Store filters in URL query params (?task=...&levels=...&search=...)
       - Allows bookmarking and sharing filtered views
       - Sync URL params with component state
    
    4. **Export functionality**:
       - Button to export current filtered logs
       - Dropdown: "Export as JSON" / "Export as CSV"
       - Downloads file with timestamp in name: "logs-2026-02-22.json"
    
    Use existing layout patterns from other pages in frontend/src/app/.
  </action>
  <verify>
    `cd frontend && npx tsc --noEmit src/app/logs/page.tsx 2>&1 | head -20`
  </verify>
  <done>
    Dedicated /logs page exists with task selector, filters, and export. URL stores filter state.
  </done>
</task>

<task type="auto">
  <name>Task 5: Add embedded log viewer to task detail page</name>
  <files>frontend/src/app/tasks/[id]/page.tsx</files>
  <action>
    Add minimal embedded log viewer to task detail page:
    
    1. **Find or read the task detail page**:
       - Read existing structure of frontend/src/app/tasks/[id]/page.tsx
       - Identify where to add the log section
    
    2. **Add embedded LogViewer**:
       - Add a "Logs" section/tab to the task detail view
       - Use LogViewer with minimal config:
         - `taskId={taskId}` — Filter to this task
         - `limit={50}` — Show recent 50 logs
         - `showFilters={false}` — Minimal view, no filters
         - `showExport={false}` — No export in embedded
         - `autoRefresh={true}` — Real-time updates for running tasks
       - Link to dedicated page: "View all logs →" linking to /logs?task={taskId}
    
    3. **Styling**:
       - Log section should be collapsible or in a tab
       - Fixed height with scroll (e.g., 300px max)
       - Fits within existing task detail layout
  </action>
  <verify>
    `grep -l "LogViewer\|logs" frontend/src/app/tasks/\\[id\\]/page.tsx`
  </verify>
  <done>
    Task detail page has embedded log viewer with auto-refresh. Shows recent logs for the task with link to dedicated page.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete log viewer frontend with embedded and dedicated views</what-built>
  <how-to-verify>
    1. Run `cd frontend && npm run dev`
    2. Navigate to http://localhost:3000/logs
    3. Verify log filtering by level (multi-select)
    4. Verify text search filters logs
    5. Test export as JSON and CSV
    6. Navigate to a task detail page and verify embedded logs
    7. Verify auto-scroll behavior (scroll up should pause, button to jump to latest)
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors
2. /logs page renders with task selector and filters
3. LogEntry shows level icons with correct colors
4. Multi-select dropdown filters multiple levels
5. Search filters logs by text
6. Export downloads JSON and CSV files
7. Embedded viewer in task detail page works
8. Auto-scroll pauses when user scrolls up
</verification>

<success_criteria>
- [ ] Log types and useLogs hook exist
- [ ] LogEntry component with level icons, truncated message, correlation chip
- [ ] LogFilters with multi-select dropdown and search
- [ ] LogViewer with auto-scroll/pause behavior
- [ ] Dedicated /logs page with task selector and export
- [ ] Embedded viewer in task detail with auto-refresh
</success_criteria>

<output>
After completion, create `.planning/phases/03-logging/03-02-SUMMARY.md`
</output>
